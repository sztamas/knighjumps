// Generated by CoffeeScript 1.6.3
(function() {
  var DEFAULT_ARROW_HEIGHT, DEFAULT_ARROW_SHAPE, DEFAULT_ARROW_WIDTH, drawPolygon, root, rotatePoint, rotateShape, translateShape,
    _this = this;

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  drawPolygon = function(context, shape) {
    var lastPoint, point, _i, _len;
    context.beginPath();
    lastPoint = shape[shape.length - 1];
    context.moveTo(lastPoint[0], lastPoint[1]);
    for (_i = 0, _len = shape.length; _i < _len; _i++) {
      point = shape[_i];
      context.lineTo(point[0], point[1]);
    }
    context.closePath();
    return context.fill();
  };

  translateShape = function(shape, x, y) {
    var point, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = shape.length; _i < _len; _i++) {
      point = shape[_i];
      _results.push([point[0] + x, point[1] + y]);
    }
    return _results;
  };

  rotatePoint = function(angle, x, y) {
    return [x * Math.cos(angle) - y * Math.sin(angle), x * Math.sin(angle) + y * Math.cos(angle)];
  };

  rotateShape = function(shape, angle) {
    var point, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = shape.length; _i < _len; _i++) {
      point = shape[_i];
      _results.push(rotatePoint(angle, point[0], point[1]));
    }
    return _results;
  };

  root.createArrow = function(width, height) {
    var halfWidth;
    halfWidth = Math.floor(width / 2);
    return [[0, 0], [-height, -halfWidth], [-height, halfWidth]];
  };

  DEFAULT_ARROW_HEIGHT = 25;

  DEFAULT_ARROW_WIDTH = 24;

  DEFAULT_ARROW_SHAPE = createArrow(DEFAULT_ARROW_WIDTH, DEFAULT_ARROW_HEIGHT);

  root.drawArrow = function(context, startPoint, endPoint, arrow) {
    var lineAngle;
    if (arrow == null) {
      arrow = DEFAULT_ARROW_SHAPE;
    }
    lineAngle = Math.atan2(endPoint.y - startPoint.y, endPoint.x - startPoint.x);
    return drawPolygon(context, translateShape(rotateShape(arrow, lineAngle), endPoint.x, endPoint.y));
  };

  root.calculateLineArrowJoinPoint = function(startPoint, endPoint, arrowHeight) {
    var lineAngle, lineEndPoint;
    if (arrowHeight == null) {
      arrowHeight = DEFAULT_ARROW_HEIGHT;
    }
    lineAngle = Math.atan2(endPoint.y - startPoint.y, endPoint.x - startPoint.x);
    lineEndPoint = rotatePoint(lineAngle, -arrowHeight, 0);
    return {
      x: endPoint.x + lineEndPoint[0],
      y: endPoint.y + lineEndPoint[1]
    };
  };

}).call(this);
